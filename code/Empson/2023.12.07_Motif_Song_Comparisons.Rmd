---
title: "MDSH Motif and Song Exploration"
author: "Tara Empson"
date: "`r Sys.Date()`"
output: html_document
---

# Read Me

-   We know that heat can reduce the rate at which male zebra finches sing. However, some males are more behaviorally resilient than others.

-   Here, we take an organismal approach to identify the mechanisms underlying individual differences in behavioral resilience. Using male zebra finches (Taeniopygia castanotis), we measured song production during a standardized heat challenge and measured gene expression via RNAseq in the brain and syrinx.

-   Here I am making data visualizations to explore song and motif distributions.

```{r}
library(tidyverse)
library(readxl)
library(janitor)
getwd()
folder <- "../../data/raw/Spring2023_MDSHrna_MaleDirectedSonginHeatforRNAseq_Round4/MDSHrna_Scored_Behavior_Data_Round4_Spring2023/2023.11.03_MDSHrna_Songs_Scored_TNS/"
dir(folder)
```

```{r}
setwd(folder)
motifs.in.song<- read_excel("Completed Song Counting Sheet.xlsx") %>% 
    clean_names() %>% 
    tail(-3) %>% 
    mutate(masked_id = str_extract(name_of_new_file, "^[A-Z]+"),
           song_index = str_extract(name_of_new_file, "[0-9]+$") |> as.integer(),
           motif_in_song = str_replace_all(number_of_motifs, "[^[:alnum:]]", " ")|> as.integer()) %>% 
    select(masked_id, song_index, motif_in_song) %>% 
    na.omit()

motifs.in.song
```

```{r}
motif.summary.info<- motifs.in.song %>% 
    group_by(masked_id) %>% 
    summarise(ave_motif_in_song=mean(motif_in_song),
           var_motif_in_song=var(motif_in_song),
           total_number_of_songs=n(), 
           total_motifs_in_songs=sum(motif_in_song)) %>% 
    ungroup() #%>% 
    #mutate(var_motif_in_song=case_when(total_number_of_songs==1~0, TRUE ~ total_number_of_songs))If there are only 0 or 1 songs should I keep variance as NA or make it 0?

motif.summary.info
```

```{r}
setwd(folder)
setwd("../")

hidden_id <- read_excel("MDSH_Video and Song Hidden IDs.xlsx") %>% 
    clean_names() %>% 
    filter(what_happened=="Given to Tamara") %>% 
    separate(original_file_name, into = c("male_id", "trial_type", "date.concat.made"), sep = "_") %>% 
    select(male_id, trial_type, new_file_name) %>% 
    rename("masked_id"="new_file_name") %>% 
    filter(masked_id!="LL") %>%  # this trial was scored twice, so just picked one to omit.
    mutate(trial_type=gsub("Real.shifted", "Real", trial_type))

treatment_and_extra_misc_information<- read_csv("misc.data.w.temp.csv") %>% 
    clean_names() %>% 
    select(bird_id, treatment, mean_temp, body_temp_post_trial_c, mass_g)

hidden_id
treatment_and_extra_misc_information
```

```{r}
real_id_with_song_summary<- full_join(hidden_id, motif.summary.info, by="masked_id") %>% 
    filter(masked_id!="LL") %>% 
    select(-masked_id) %>% 
    mutate(total_number_of_songs=case_when(is.na(total_number_of_songs)~0,
                                           TRUE ~ total_number_of_songs)) %>% 
    group_by(male_id) %>% 
    mutate(var_song_num=var(total_number_of_songs)) %>% 
    ungroup()
        
real_id_with_song_summary

full.song.summary.data<- full_join(real_id_with_song_summary, treatment_and_extra_misc_information, by=join_by("male_id"=="bird_id")) %>% 
    relocate(male_id, treatment, trial_type, total_number_of_songs, total_motifs_in_songs)
full.song.summary.data 
```

Histogram from Each day -Visual day was 24 hours before the Real trial, the chamber was not on, so it was at room temperature for both treatments.

```{r}
full.song.summary.data%>% 
    ggplot(aes(x=total_number_of_songs, alpha=fct_rev(trial_type)))+
    geom_histogram(bins = 20)+
    theme_light()+
    labs(title="Song counts on Visual and Real Day", alpha="Trial Type")

full.song.summary.data %>% 
    ggplot(aes(x=total_number_of_songs,fill=trial_type))+
    geom_histogram(bins = 20)+
    facet_wrap(~fct_rev(trial_type))+
    theme_light()+
    labs(title="Song counts on Visual and Real Day", fill="Trial Type" )

motif.in.song.histogram.trial.type<- full.song.summary.data%>% 
    ggplot(aes(x=total_motifs_in_songs, alpha=fct_rev(trial_type)))+
    geom_histogram(bins = 20)+
    theme_light()+
    labs(title="Motif counts on Visual and Real Day", alpha="Trial Type")
motif.in.song.histogram.trial.type
motif.in.song.histogram.trial.type+
    facet_wrap(~fct_rev(trial_type))
```

Does number of Songs sang on Day 1 correlate with number of Songs sang on Day 2
```{r}
pivoted <- full.song.summary.data %>% pivot_wider(names_from = trial_type, values_from = 4:7)

pivoted %>% 
    ggplot(aes(x=total_number_of_songs_Visual,y=total_number_of_songs_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```

Does number of Motifs sang on Day 1 correlate with number of Songs sang on Day 2
```{r}
pivoted %>% 
    ggplot(aes(x=total_motifs_in_songs_Visual,y=total_motifs_in_songs_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```

Does number of Songs correlate with number of motifs?
Why doesn't the line align with the points anymore?
```{r}
pivoted %>% 
    ggplot(aes(x=total_motifs_in_songs_Visual,y=total_number_of_songs_Visual))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)

pivoted %>% 
    ggplot(aes(x=total_motifs_in_songs_Real,y=total_number_of_songs_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```


Does number of songs correlate with average number of motifs?
```{r}
pivoted %>% 
    ggplot(aes(x=total_number_of_songs_Visual,y=ave_motif_in_song_Visual))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
pivoted %>% 
    ggplot(aes(x=total_number_of_songs_Real,y=ave_motif_in_song_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```

Does number of motifs correlate with average number of motifs?
```{r}
pivoted %>% 
    ggplot(aes(x=total_motifs_in_songs_Visual,y=ave_motif_in_song_Visual))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
pivoted %>% 
    ggplot(aes(x=total_motifs_in_songs_Real,y=ave_motif_in_song_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```


Does average number of Motifs sang on Day 1 correlate with average number of Motifs sang on Day 2?
```{r}
pivoted %>% 
    ggplot(aes(x=ave_motif_in_song_Visual,y=ave_motif_in_song_Real))+
    geom_point()+
    geom_smooth(method="lm",color="red", se=FALSE)
```



Variance

```{r}
full.song.summary.data %>% 
    ggplot(aes(x=var_motif_in_song))+
    geom_histogram(bins = 20)+
    theme_light()+
    labs(title="Variance in number of of motifs in a song") #warning is because of 18 NA's (1 song on a day from 18 recordings)

full.song.summary.data %>% 
    ggplot(aes(x=var_song_num))+
    geom_histogram(bins = 20)+
    theme_light()+
    labs(title="Variance in number of of songs between 2 days") #warning is because of 1 NA (1 bird was only recorded once.)
```

Scatterplot
#motif.scatter.trial.type<- full.song.summary.data %>%
#ggplot(aes(y=~filter(.data,trial_type="Visual"), x=~filter(.data,trial_type="Visual")))
#motif.scatter.trial.type
```{r}
full.song.summary.data %>% 
ggplot(aes(x=fct_rev(trial_type), y=log(total_motifs_in_songs), group=male_id))+
    geom_line()+
    geom_point()+
    facet_wrap(~treatment)
```


```{r}
full.song.summary.data %>% 
    ggplot(aes(x=total_number_of_songs, y=var_motif_in_song))+
    geom_point()+
    geom_smooth(method="lm")

full.song.summary.data %>% 
    ggplot(aes(x=total_number_of_songs, y=var_song_num))+
    geom_point()

```

Scatterplot

```{r}
full.song.summary.data %>% 
    ggplot(aes(x=total_number_of_songs, y=mean_temp))+
    geom_point()+
    geom_smooth(method = "lm")

full.song.summary.data %>% 
    ggplot(aes(x=total_motifs_in_songs, y=mean_temp))+
    geom_point()+
    geom_smooth(method = "lm")
```
